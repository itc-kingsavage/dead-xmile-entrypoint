<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DEAD-XMILE | Session Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Main Styles -->
  <link rel="stylesheet" href="./css/style.css">
</head>

<body>

  <img id="logo" src="./img/logo.png" alt="Scanner Logo">

  <h1>ðŸ”¥ DEAD-X-BOT SCANNER ðŸ”¥</h1>
  <p>Generate QR & Pairing Code to link your WhatsApp session</p>

  <div class="scanner-box">

    <p id="status" class="loader">Initializing scanner...</p>

    <img id="qrImage" style="display:none;" />

    <div id="sessionBox" style="display:none;">
      <p><b>Session ID</b></p>
      <input id="sessionId" readonly />
      <br>
      <button id="copyBtn">Copy Session ID</button>
    </div>

    <button id="regenBtn">Generate New QR</button>

  </div>

  <script>
    const qrImg = document.getElementById("qrImage");
    const statusText = document.getElementById("status");
    const sessionBox = document.getElementById("sessionBox");
    const sessionInput = document.getElementById("sessionId");
    const copyBtn = document.getElementById("copyBtn");
    const regenBtn = document.getElementById("regenBtn");

    async function generateQR() {
      statusText.innerText = "Generating QR...";
      qrImg.style.display = "none";
      sessionBox.style.display = "none";

      try {
        const res = await fetch("/qr");
        const data = await res.json();

        if (!data.success) {
          statusText.innerText = "Error: " + (data.error || "QR generation failed");
          return;
        }

        qrImg.src = data.qr;
        qrImg.style.display = "block";

        sessionInput.value = data.sessionId;
        sessionBox.style.display = "block";

        statusText.innerText = `Scan QR within ${data.expiresIn / 1000}s`;

      } catch (err) {
        statusText.innerText = "Network error. Try again.";
      }
    }

    copyBtn.onclick = () => {
      sessionInput.select();
      document.execCommand("copy");
      statusText.innerText = "Session ID copied âœ“";
    };

    regenBtn.onclick = generateQR;

    generateQR();
  </script>
</body>
</html>
